<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>3D Heart — WebXR / three.js</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body { height:100%; margin:0; overflow:hidden; background:#111; }
    #info {
      position: absolute; left: 10px; top: 10px; color: #fff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      z-index: 2; background: rgba(0,0,0,0.35); padding:8px 12px; border-radius:8px;
    }
    a { color: #ff99cc }
  </style>
</head>
<body>
  <div id="info">3D Heart — click ENTER VR to view in Nidhi's VR. Use mouse to orbit when not in VR.</div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.153.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.153.0/examples/jsm/controls/OrbitControls.js';
    import { VRButton } from 'https://unpkg.com/three@0.153.0/examples/jsm/webxr/VRButton.js';

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Scene + Camera
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b0b0f);

    const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.set(0, 1.2, 3);

    // Lights
    const hemi = new THREE.HemisphereLight(0xffeebb, 0x080820, 0.8);
    scene.add(hemi);

    const dir = new THREE.DirectionalLight(0xffffff, 1.0);
    dir.position.set(5, 10, 7.5);
    dir.castShadow = true;
    scene.add(dir);

    // Ground / soft reflection
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(30, 30),
      new THREE.MeshStandardMaterial({ color: 0x06060a, roughness: 1, metalness: 0 })
    );
    ground.rotation.x = -Math.PI/2;
    ground.position.y = -1.3;
    scene.add(ground);

    // Create heart shape (2D) using param equation then extrude
    function makeHeartShape(scale=1.0) {
      const x = t => 16*Math.pow(Math.sin(t),3);
      const y = t => 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
      // sample curve t from 0..2π
      const shape = new THREE.Shape();
      const pts = [];
      const steps = 120;
      for (let i=0;i<=steps;i++){
        const t = i/steps * Math.PI * 2;
        pts.push(new THREE.Vector2(x(t)*scale*0.02, y(t)*scale*0.02)); // shrink a bit
      }
      // move to first
      shape.moveTo(pts[0].x, pts[0].y);
      for (let i=1;i<pts.length;i++){
        shape.lineTo(pts[i].x, pts[i].y);
      }
      return shape;
    }

    const heartShape = makeHeartShape(1.0);
    const extrudeSettings = {
      depth: 0.4,
      bevelEnabled: true,
      bevelThickness: 0.05,
      bevelSize: 0.06,
      bevelSegments: 6,
    };
    const geometry = new THREE.ExtrudeGeometry(heartShape, extrudeSettings);
    geometry.center(); // center geometry

    // Material — slightly glossy pink
    const material = new THREE.MeshStandardMaterial({
      color: 0xff3d6b,
      metalness: 0.2,
      roughness: 0.35,
      emissive: 0x220011,
      emissiveIntensity: 0.08,
    });

    const heart = new THREE.Mesh(geometry, material);
    heart.castShadow = true;
    heart.receiveShadow = true;
    scene.add(heart);

    // Add a subtle rim glow via second mesh (scaled) with transparent fresnel-like material
    const rimMat = new THREE.MeshStandardMaterial({
      color: 0xff8fb0,
      emissive: 0xff6f9b,
      emissiveIntensity: 0.12,
      roughness: 1.0,
      metalness: 0,
      transparent: true,
      opacity: 0.25,
      depthWrite: false,
    });
    const rim = new THREE.Mesh(geometry.clone(), rimMat);
    rim.scale.set(1.03,1.03,1.03);
    scene.add(rim);

    // Floating group so heart can bob/rotate
    const group = new THREE.Group();
    group.add(heart);
    group.add(rim);
    group.position.y = 0;
    scene.add(group);

    // Add small point lights to accent
    const p1 = new THREE.PointLight(0xff7aa1, 0.6, 5.0);
    p1.position.set(-1.5, 1.5, 1);
    scene.add(p1);
    const p2 = new THREE.PointLight(0xffb3c8, 0.4, 5.0);
    p2.position.set(1.2, 0.5, -1);
    scene.add(p2);

    // Orbit controls (for desktop fallback)
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 0, 0);
    controls.update();

    // VR button
    document.body.appendChild(VRButton.createButton(renderer));

    // Resize handler
    window.addEventListener('resize', onWindowResize);
    function onWindowResize(){
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // Animation loop
    const clock = new THREE.Clock();
    renderer.setAnimationLoop(animate); // works for both VR and non-VR

    function animate() {
      const t = clock.getElapsedTime();

      // gentle bob + heartbeat scale pulse
      group.position.y = Math.sin(t * 1.5) * 0.08;
      const beat = 1 + Math.abs(Math.sin(t*3.5)) * 0.08; // pulsing scale
      group.scale.set(beat, beat, beat);

      // slow rotation
      group.rotation.y += 0.005;

      // update rim opacity subtly
      rim.material.opacity = 0.18 + 0.06 * Math.sin(t*2.5);

      renderer.render(scene, camera);
    }

    // Helpful tip: if WebXR is not available, show message
    if (navigator.xr === undefined) {
      const info = document.getElementById('info');
      info.innerHTML += '<br><small>Note: WebXR not available in this browser. Use a WebXR-capable browser (Oculus Browser, Chrome with WebXR) to enter VR.</small>';
    }
  </script>
</body>
</html>
